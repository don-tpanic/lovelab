### Modules

import numpy as np

### Experimental settings

# Set the number of trials here
trials=200
questions=8
batch_name="control2"
trend=0


### Read results file

loading=open("results_"+batch_name+".csv")
content=loading.readlines()
loading.close()



# No. of participants
participants=content[0].count("\r")

# Splitting the rows
rows=np.array([])

for element in content:
    line=element.split("\r")
    rows=np.append(rows, line)

# Splitting the datapoints
all_data=np.array([])

for element in rows:
    datapoint=element.split(",")
    all_data=np.append(all_data, datapoint)

"""

# No. of participants
participants=len(content)-1

# Splitting the datapoints
all_data=np.array([])

for element in content:
    datapoint=element.split(",")
    all_data=np.append(all_data, datapoint)

"""

# Setup positions where to find which values
interval=3*trials+2

# Code choices for each subject
subj_data={}
for x in range(1, participants+1):
    coded_choices=[]
    code=-99
    obs_value_a=-99
    obs_value_b=-99
    for i in range(1, trials+1):
        choice=all_data[x*interval+i]
        value_a=float(all_data[x*interval+trials+i])
        value_b=float(all_data[x*interval+2*trials+i])
        if choice=='A':
            if obs_value_a!=-99 and obs_value_b!=-99:
                if obs_value_a>obs_value_b:
                    code=0
                elif obs_value_a<obs_value_b:
                    code=1
            obs_value_a=value_a
            if obs_value_b!=-99:
                obs_value_b+=trend
        elif choice=='B':
            if obs_value_a!=-99 and obs_value_b!=-99:
                if obs_value_a>obs_value_b:
                    code=1
                elif obs_value_a<obs_value_b:
                    code=0
            obs_value_b=value_b
            if obs_value_a!=-99:
                obs_value_a+=trend
        else:
            code=-99
        try:
            coded_choices.append(code)
        except:
            pass
        
    subj_data[all_data[x*interval]]=coded_choices


### Write new file
    
storage=open("coded_"+batch_name+".csv", "w")

storage.write("Subject")
for t in range(1, trials+1):
    storage.write(",Choice"+str(t))
storage.write("\n")

for name in subj_data:
    storage.write(name)
    for i in range(0, len(subj_data[name])):
        storage.write(","+str(subj_data[name][i]))
    storage.write("\n")

storage.close()
